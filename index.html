<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reparations ‚àà ‚Ñù</title>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

    <!-- Main Stylesheet (extracted from inline) -->
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Person Profile Modal -->
    <div class="person-modal-overlay" id="personModalOverlay" onclick="closePersonModal(event)">
        <div class="person-modal" onclick="event.stopPropagation()">
            <div class="person-modal-header">
                <div>
                    <h2 class="person-name" id="modalPersonName">Loading...</h2>
                    <span class="person-type-badge" id="modalPersonType">unknown</span>
                </div>
                <button class="person-modal-close" onclick="closePersonModal()">&times;</button>
            </div>
            <div class="person-modal-body" id="modalPersonBody">
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner" style="margin: 0 auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section - Full Screen -->
    <div class="hero-container">
        <!-- Wallet Button -->
        <button class="wallet-btn" id="walletBtn" onclick="connectWallet()">
            Connect Wallet
        </button>

        <!-- System Status -->
        <div class="system-status-badge">
            <div class="status-dot"></div>
            <span id="systemStatus">Connecting...</span>
        </div>

        <!-- Title -->
        <div class="hero-title">
            <h1>Reparations ‚àà ‚Ñù</h1>
            <p class="subtitle">you can do it, put your back into it</p>
        </div>

        <!-- Live Stats -->
        <div class="stats-ribbon">
            <div class="stat-item">
                <div class="stat-number" id="statRecords">--</div>
                <div class="stat-label">Database Records</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="statSlaveholders">--</div>
                <div class="stat-label">Slaveholders Identified</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="statEnslaved">--</div>
                <div class="stat-label">Enslaved People</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="statSources">--</div>
                <div class="stat-label">Source Archives</div>
            </div>
        </div>

        <!-- Search Box -->
        <div class="search-hero">
            <div class="search-input-wrapper">
                <input
                    type="text"
                    id="searchInput"
                    placeholder="Search by name, location, or document..."
                    onkeypress="if(event.key === 'Enter') performSearch()"
                />
                <button class="search-btn" onclick="performSearch()">Search</button>
            </div>
            <p class="search-hint">Try: "James Hopewell", "Montgomery County", or "Nancy D'Wolf"</p>
        </div>

        <!-- Search Results Panel -->
        <div class="search-results-panel" id="searchResultsPanel">
            <div class="results-header">
                <h3 id="resultsTitle">Search Results</h3>
                <button class="results-close" onclick="closeSearchResults()">&times;</button>
            </div>
            <div class="results-list" id="resultsList">
                <!-- Results populate here -->
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="openPanel('progress')">
                <span id="progressIndicator"></span>
                Extraction Progress
            </button>
            <a href="bibliography.html" class="quick-action-btn">View Sources</a>
            <button class="quick-action-btn" onclick="openPanel('formula')">Calculate Reparations</button>
        </div>
    </div>

    <!-- Bottom Navigation Bar -->
    <div class="bottom-bar">
        <div class="nav-item" onclick="openPanel('documents')">
            <span class="nav-icon">üìú</span>
            <span class="nav-label">Documents</span>
        </div>
        <div class="nav-item" onclick="openPanel('people')" id="peopleNavItem">
            <span class="nav-icon">üë•</span>
            <span class="nav-label">People</span>
            <span class="people-badge" id="peopleBadge">--</span>
        </div>
        <div class="nav-item" onclick="openPanel('formula')">
            <span class="nav-icon">üìä</span>
            <span class="nav-label">Formula</span>
        </div>
        <div class="nav-item active" onclick="closeAllPanels()">
            <span class="nav-icon">üîç</span>
            <span class="nav-label">Search</span>
        </div>
        <div class="nav-item" onclick="openPanel('chat')">
            <span class="nav-icon">üí¨</span>
            <span class="nav-label">Assistant</span>
        </div>
        <div class="nav-item" onclick="openPanel('upload')">
            <span class="nav-icon">üì§</span>
            <span class="nav-label">Upload</span>
        </div>
        <div class="nav-item" onclick="openPanel('quality')" id="qualityNavItem">
            <span class="nav-icon">üßπ</span>
            <span class="nav-label">Clean Data</span>
            <span class="quality-badge" id="qualityBadge" style="display: none;"></span>
        </div>
        <div class="nav-item" onclick="openPanel('progress')" id="progressNavItem">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span class="nav-label">Progress</span>
            <span class="progress-badge" id="progressBadge" style="display: none;"></span>
        </div>
    </div>

    <!-- Feature Panels -->

    <!-- Documents Panel -->
    <div class="feature-panel" id="documentsPanel">
        <div class="panel-header">
            <h2>Documented Records</h2>
            <button class="panel-close" onclick="closePanel('documents')">&times;</button>
        </div>
        <div class="documents-grid" id="documentsList">
            <div style="text-align: center; color: #9aa5b1; padding: 40px;">
                <div class="spinner" style="margin: 0 auto 15px;"></div>
                Loading documents...
            </div>
        </div>
    </div>

    <!-- People Panel - Browse All Persons in Database -->
    <div class="feature-panel" id="peoplePanel">
        <div class="panel-header">
            <h2>Browse People Database</h2>
            <button class="panel-close" onclick="closePanel('people')">&times;</button>
        </div>
        <div class="panel-filters" style="display: flex; gap: 10px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 15px;">
            <select id="peopleTypeFilter" onchange="loadPeople()" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #3a4a6b; background: #1e2a4a; color: white;">
                <option value="">All Types</option>
                <option value="enslaved">Enslaved Persons</option>
                <option value="owner">Slaveholders</option>
            </select>
            <select id="peopleSourceFilter" onchange="loadPeople()" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #3a4a6b; background: #1e2a4a; color: white;">
                <option value="">All Sources</option>
                <option value="familysearch">FamilySearch</option>
                <option value="msa">Maryland Archives</option>
                <option value="beyond_kin">Beyond Kin</option>
            </select>
            <select id="peopleConfidenceFilter" onchange="loadPeople()" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #3a4a6b; background: #1e2a4a; color: white;">
                <option value="0">Any Confidence</option>
                <option value="0.5">50%+ Confidence</option>
                <option value="0.7">70%+ Confidence</option>
                <option value="0.9">90%+ Confidence</option>
            </select>
        </div>
        <div class="people-stats" style="display: flex; gap: 15px; margin-bottom: 15px;">
            <div style="flex: 1; padding: 15px; background: rgba(100, 181, 246, 0.1); border-radius: 10px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #64b5f6;" id="peopleTotalCount">--</div>
                <div style="font-size: 12px; color: #9aa5b1;">Total Records</div>
            </div>
            <div style="flex: 1; padding: 15px; background: rgba(100, 255, 100, 0.1); border-radius: 10px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #64ff64;" id="peopleEnslavedCount">--</div>
                <div style="font-size: 12px; color: #9aa5b1;">Enslaved</div>
            </div>
            <div style="flex: 1; padding: 15px; background: rgba(255, 100, 100, 0.1); border-radius: 10px; text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #ff6464;" id="peopleOwnerCount">--</div>
                <div style="font-size: 12px; color: #9aa5b1;">Slaveholders</div>
            </div>
        </div>
        <div class="people-list" id="peopleList" style="max-height: calc(100vh - 350px); overflow-y: auto;">
            <div style="text-align: center; color: #9aa5b1; padding: 40px;">
                <div class="spinner" style="margin: 0 auto 15px;"></div>
                Loading people database...
            </div>
        </div>
        <div class="people-pagination" style="display: flex; justify-content: center; gap: 10px; padding: 15px;">
            <button onclick="loadPeople(Math.max(0, window.peopleOffset - 100))" id="peoplePrevBtn" style="padding: 10px 20px; border-radius: 8px; border: none; background: #3a4a6b; color: white; cursor: pointer;" disabled>Previous</button>
            <span id="peoplePageInfo" style="padding: 10px 20px; color: #9aa5b1;">Page 1</span>
            <button onclick="loadPeople(window.peopleOffset + 100)" id="peopleNextBtn" style="padding: 10px 20px; border-radius: 8px; border: none; background: #3a4a6b; color: white; cursor: pointer;">Next</button>
        </div>
    </div>

    <!-- Formula Panel -->
    <div class="feature-panel" id="formulaPanel">
        <div class="panel-header">
            <h2>Reparations Calculation Formula</h2>
            <button class="panel-close" onclick="closePanel('formula')">&times;</button>
        </div>
        <div class="formula-grid">
            <div class="formula-card">
                <h3>Wage Theft</h3>
                <p>Count √ó $120/day √ó Years √ó 300 days √ó inflation</p>
            </div>
            <div class="formula-card">
                <h3>Human Dignity Damages</h3>
                <p>Count √ó $15,000 √ó Years √ó 1.5 multiplier</p>
            </div>
            <div class="formula-card">
                <h3>Profit Share</h3>
                <p>Count √ó $300/year √ó Years √ó inflation √ó 40%</p>
            </div>
            <div class="formula-card">
                <h3>Compound Interest (4%)</h3>
                <p>Subtotal √ó (1.04^224 - 1)</p>
            </div>
            <div class="formula-card">
                <h3>Delayed Justice (2%)</h3>
                <p>Subtotal √ó 2% √ó 224 years</p>
            </div>
            <div class="formula-result-box">
                <div class="amount">$2,200,000</div>
                <div class="label">Average Per Person (25 years enslavement)</div>
            </div>
        </div>
    </div>

    <!-- Chat Panel -->
    <div class="feature-panel" id="chatPanel">
        <div class="panel-header">
            <h2>Research Assistant</h2>
            <button class="panel-close" onclick="closePanel('chat')">&times;</button>
        </div>
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message assistant">
                    Ask me about the database: owners, documents, enslaved people, families, or statistics.
                </div>
            </div>
            <div class="chat-input-wrapper">
                <input
                    type="text"
                    id="chatInput"
                    placeholder="Ask about James Hopewell, family structures, statistics..."
                    onkeypress="if(event.key === 'Enter') sendChat()"
                />
                <button onclick="sendChat()">Send</button>
            </div>
        </div>
    </div>

    <!-- Upload Panel -->
    <div class="feature-panel" id="uploadPanel">
        <div class="panel-header">
            <h2>Upload Documents</h2>
            <button class="panel-close" onclick="closePanel('upload')">&times;</button>
        </div>
        <input type="file" id="fileInput" multiple accept=".pdf,.jpg,.jpeg,.png,.heic" onchange="handleFileSelect(event)" />
        <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
            <div class="icon">üìÑ</div>
            <div class="text">Drop files here or click to browse</div>
            <div class="hint">Supports PDF, JPG, PNG, HEIC</div>
        </div>
        <div id="uploadQueue" style="margin-top: 20px;"></div>
    </div>

    <!-- Data Quality Panel -->
    <div class="feature-panel" id="qualityPanel">
        <div class="panel-header">
            <h2>Data Quality Dashboard</h2>
            <button class="panel-close" onclick="closePanel('quality')">&times;</button>
        </div>

        <!-- Stats Row -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
            <div style="background: rgba(255,100,100,0.1); border: 1px solid rgba(255,100,100,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 2em; color: #ff6464; font-weight: bold;" id="qualityTotalIssues">-</div>
                <div style="color: #9aa5b1; font-size: 0.85em;">Total Issues</div>
            </div>
            <div style="background: rgba(100,200,255,0.1); border: 1px solid rgba(100,200,255,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 2em; color: #64c8ff; font-weight: bold;" id="qualityLowConf">-</div>
                <div style="color: #9aa5b1; font-size: 0.85em;">Low Confidence</div>
            </div>
            <div style="background: rgba(255,200,100,0.1); border: 1px solid rgba(255,200,100,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 2em; color: #ffc864; font-weight: bold;" id="qualityMissingOwner">-</div>
                <div style="color: #9aa5b1; font-size: 0.85em;">Missing Owner</div>
            </div>
        </div>

        <!-- Quick Fix Buttons -->
        <div style="margin-bottom: 20px;">
            <h3 style="color: #64c8ff; margin-bottom: 15px; font-size: 1.1em;">Quick Fixes</h3>
            <div id="qualityFixButtons" style="display: flex; flex-wrap: wrap; gap: 10px;">
                <div style="color: #9aa5b1;">Loading fixes...</div>
            </div>
        </div>

        <!-- Records to Review -->
        <div>
            <h3 style="color: #64c8ff; margin-bottom: 15px; font-size: 1.1em;">Records Needing Review</h3>
            <div id="qualityRecords" style="max-height: 300px; overflow-y: auto;">
                <div style="color: #9aa5b1; text-align: center; padding: 20px;">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Extraction Progress Panel -->
    <div class="feature-panel" id="progressPanel">
        <div class="panel-header">
            <h2>Extraction Progress</h2>
            <button class="panel-close" onclick="closePanel('progress')">&times;</button>
        </div>

        <!-- Current Job -->
        <div id="currentJobSection">
            <h3 style="color: #64c8ff; margin-bottom: 15px; font-size: 1.1em;">Current Extraction</h3>
            <div id="currentJob" style="background: rgba(100,200,255,0.1); border: 1px solid rgba(100,200,255,0.3); border-radius: 10px; padding: 20px;">
                <div style="text-align: center; color: #9aa5b1;">Loading...</div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; margin: 20px 0;">
            <div style="background: rgba(100,255,150,0.1); border: 1px solid rgba(100,255,150,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 1.8em; color: #64ff96; font-weight: bold;" id="progressLocations">-</div>
                <div style="color: #9aa5b1; font-size: 0.8em;">Counties</div>
            </div>
            <div style="background: rgba(100,200,255,0.1); border: 1px solid rgba(100,200,255,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 1.8em; color: #64c8ff; font-weight: bold;" id="progressImages">-</div>
                <div style="color: #9aa5b1; font-size: 0.8em;">Images</div>
            </div>
            <div style="background: rgba(255,200,100,0.1); border: 1px solid rgba(255,200,100,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 1.8em; color: #ffc864; font-weight: bold;" id="progressOwners">-</div>
                <div style="color: #9aa5b1; font-size: 0.8em;">Slaveholders</div>
            </div>
            <div style="background: rgba(200,150,255,0.1); border: 1px solid rgba(200,150,255,0.3); padding: 15px; border-radius: 10px; text-align: center;">
                <div style="font-size: 1.8em; color: #c896ff; font-weight: bold;" id="progressEnslaved">-</div>
                <div style="color: #9aa5b1; font-size: 0.8em;">Enslaved</div>
            </div>
        </div>

        <!-- Recent Jobs -->
        <div style="margin-top: 20px;">
            <h3 style="color: #64c8ff; margin-bottom: 15px; font-size: 1.1em;">Recent Jobs</h3>
            <div id="recentJobs" style="max-height: 250px; overflow-y: auto;">
                <div style="color: #9aa5b1; text-align: center; padding: 20px;">Loading...</div>
            </div>
        </div>

        <!-- Auto-refresh indicator -->
        <div style="text-align: center; margin-top: 15px; color: #6b7280; font-size: 0.85em;">
            <span id="progressRefreshIndicator">‚ü≥</span> Auto-refreshes every 10 seconds
        </div>
    </div>

    <!-- Document Viewer Modal -->
    <div class="document-viewer-modal" id="documentViewer">
        <div class="doc-viewer-main">
            <div class="doc-viewer-controls">
                <button class="doc-control-btn" onclick="zoomDocument()">Zoom</button>
                <button class="doc-control-btn" onclick="downloadDocument()">Download</button>
                <button class="doc-control-btn close" onclick="closeDocViewer()">&times; Close</button>
            </div>
            <div class="doc-viewer-content" id="docViewerContent">
                <!-- Document renders here -->
            </div>
        </div>
        <div class="doc-viewer-sidebar" id="docViewerSidebar">
            <h3 style="color: #64c8ff; margin-bottom: 20px;">Document Details</h3>
            <div id="docMetadata"></div>
        </div>
    </div>


    <!-- Main Application JavaScript (extracted from inline) -->
    <script src="js/app.js"></script>
</body>
</html>
