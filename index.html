<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reparations Accountability Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0e27;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        /* Top Icon Bar */
        .icon-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 20px;
            gap: 15px;
            z-index: 1000;
            border-bottom: 1px solid rgba(100, 200, 255, 0.2);
        }

        .icon-btn {
            background: rgba(100, 200, 255, 0.1);
            border: 1px solid rgba(100, 200, 255, 0.3);
            color: #64c8ff;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: rgba(100, 200, 255, 0.2);
            border-color: rgba(100, 200, 255, 0.5);
        }

        .wallet-status {
            padding: 8px 12px;
            background: rgba(255, 100, 100, 0.1);
            border: 1px solid rgba(255, 100, 100, 0.3);
            border-radius: 5px;
            font-size: 11px;
            color: #ff6464;
        }

        .wallet-status.connected {
            background: rgba(100, 255, 100, 0.1);
            border-color: rgba(100, 255, 100, 0.3);
            color: #64ff64;
        }

        /* Main Container */
        .dashboard {
            margin-top: 50px;
            height: calc(100vh - 50px);
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        /* Widget 1: Rotating Forest (Top Half) */
        .widget-forest {
            height: 50vh;
            background: linear-gradient(180deg, #0a0e27 0%, #1a1e3f 100%);
            border-bottom: 2px solid rgba(100, 200, 255, 0.3);
            position: relative;
            overflow: hidden;
            perspective: 1200px;
        }

        .forest-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
        }

        .forest-title h1 {
            font-size: 2em;
            color: #64c8ff;
            text-shadow: 0 0 20px rgba(100, 200, 255, 0.5);
        }

        .carousel-container {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .carousel {
            position: relative;
            width: 800px;
            height: 400px;
            transform-style: preserve-3d;
            transition: transform 1s ease;
        }

        .tree-card {
            position: absolute;
            width: 300px;
            height: 350px;
            background: rgba(30, 40, 70, 0.9);
            border: 2px solid rgba(100, 200, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            transform-style: preserve-3d;
            backface-visibility: hidden;
        }

        .tree-card:hover {
            border-color: rgba(100, 200, 255, 0.8);
            box-shadow: 0 0 30px rgba(100, 200, 255, 0.4);
            transform: scale(1.05) !important;
        }

        .tree-card.active {
            border-color: #64ff64;
            box-shadow: 0 0 40px rgba(100, 255, 100, 0.5);
        }

        .owner-name {
            font-size: 1.3em;
            color: #ff6464;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 100, 100, 0.3);
            padding-bottom: 8px;
        }

        .tree-content {
            max-height: 280px;
            overflow-y: auto;
            font-size: 0.85em;
        }

        .tree-content::-webkit-scrollbar {
            width: 6px;
        }

        .tree-content::-webkit-scrollbar-track {
            background: rgba(100, 200, 255, 0.1);
            border-radius: 3px;
        }

        .tree-content::-webkit-scrollbar-thumb {
            background: rgba(100, 200, 255, 0.3);
            border-radius: 3px;
        }

        .enslaved-person {
            background: rgba(100, 200, 255, 0.1);
            margin: 5px 0;
            padding: 8px;
            border-radius: 5px;
            border-left: 3px solid #64c8ff;
        }

        .person-name {
            font-weight: bold;
            color: #64c8ff;
        }

        .person-relation {
            color: #9aa5b1;
            font-size: 0.9em;
            font-style: italic;
        }

        .descendant-section {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid rgba(100, 255, 100, 0.3);
        }

        .descendant-label {
            color: #64ff64;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .reparations-view .enslaved-person {
            border-left-color: #ffaa00;
            background: rgba(255, 170, 0, 0.1);
        }

        .reparations-amount {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffaa00;
        }

        .carousel-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }

        .control-btn {
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid rgba(100, 200, 255, 0.5);
            color: #64c8ff;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: rgba(100, 200, 255, 0.4);
        }

        /* Bottom Row: 3 Widgets */
        .bottom-row {
            height: 50vh;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0;
        }

        .widget {
            background: #1a1e3f;
            border-right: 1px solid rgba(100, 200, 255, 0.2);
            padding: 20px;
            overflow-y: auto;
        }

        .widget:last-child {
            border-right: none;
        }

        .widget h2 {
            color: #64c8ff;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid rgba(100, 200, 255, 0.3);
            padding-bottom: 10px;
        }

        /* Widget 2: Formula Calculator */
        .formula-display {
            background: rgba(30, 40, 70, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(100, 200, 255, 0.3);
            font-family: 'Courier New', monospace;
            margin-bottom: 20px;
        }

        .formula-line {
            margin: 10px 0;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
            padding: 5px;
            border-radius: 3px;
        }

        .formula-line:hover {
            background: rgba(100, 200, 255, 0.2);
            color: #64c8ff;
        }

        .formula-component {
            color: #ffaa00;
            font-weight: bold;
        }

        .formula-result {
            font-size: 1.2em;
            color: #64ff64;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(100, 200, 255, 0.3);
        }

        .victim-selector {
            margin-top: 20px;
        }

        .victim-selector select {
            width: 100%;
            padding: 10px;
            background: rgba(30, 40, 70, 0.8);
            border: 1px solid rgba(100, 200, 255, 0.5);
            color: #e0e0e0;
            border-radius: 5px;
            font-size: 0.9em;
        }

        /* Widget 3: Data Browser */
        .owner-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .owner-item {
            background: rgba(30, 40, 70, 0.6);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #64c8ff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .owner-item:hover {
            background: rgba(30, 40, 70, 0.9);
            border-left-color: #64ff64;
            transform: translateX(5px);
        }

        .owner-item-name {
            font-weight: bold;
            color: #64c8ff;
            margin-bottom: 5px;
        }

        .owner-item-details {
            font-size: 0.85em;
            color: #9aa5b1;
        }

        .owner-item-count {
            color: #ffaa00;
            font-weight: bold;
        }

        /* Widget 4: Console */
        .console-container {
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }

        .console-output {
            flex: 1;
            background: rgba(10, 14, 39, 0.8);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-bottom: 15px;
        }

        .console-line {
            margin: 5px 0;
            color: #9aa5b1;
        }

        .console-line.success {
            color: #64ff64;
        }

        .console-line.error {
            color: #ff6464;
        }

        .console-line.info {
            color: #64c8ff;
        }

        .console-input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .console-input {
            width: 100%;
            padding: 10px;
            background: rgba(30, 40, 70, 0.8);
            border: 1px solid rgba(100, 200, 255, 0.5);
            color: #e0e0e0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            min-height: 60px;
        }

        .console-buttons {
            display: flex;
            gap: 10px;
        }

        .console-btn {
            flex: 1;
            padding: 10px;
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid rgba(100, 200, 255, 0.5);
            color: #64c8ff;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .console-btn:hover {
            background: rgba(100, 200, 255, 0.4);
        }

        .file-upload-label {
            flex: 1;
            padding: 10px;
            background: rgba(255, 170, 0, 0.2);
            border: 1px solid rgba(255, 170, 0, 0.5);
            color: #ffaa00;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .file-upload-label:hover {
            background: rgba(255, 170, 0, 0.4);
        }

        #fileUpload {
            display: none;
        }

        /* Modal for formula explanations */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1e3f;
            border: 2px solid rgba(100, 200, 255, 0.5);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            color: #64c8ff;
            margin-bottom: 15px;
        }

        .modal-content p {
            color: #e0e0e0;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .modal-close {
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid rgba(255, 100, 100, 0.5);
            color: #ff6464;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        .modal-close:hover {
            background: rgba(255, 100, 100, 0.4);
        }
    </style>
</head>
<body>
    <!-- Top Icon Bar -->
    <div class="icon-bar">
        <span class="wallet-status" id="walletStatus">Not Connected</span>
        <button class="icon-btn" id="connectWallet">🔗 Connect Wallet</button>
        <button class="icon-btn" onclick="exportData()">📊 Export Report</button>
        <button class="icon-btn" onclick="showSettings()">⚙️ Settings</button>
        <button class="icon-btn" onclick="showHelp()">❓ Help</button>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard">
        <!-- Widget 1: Rotating Forest of Family Trees -->
        <div class="widget-forest">
            <div class="forest-title">
                <h1>Reparations ∈ R</h1>
            </div>

            <div class="carousel-container">
                <div class="carousel" id="carousel">
                    <!-- Trees will be dynamically generated -->
                </div>
            </div>

            <div class="carousel-controls">
                <button class="control-btn" onclick="rotateCarousel(-1)">← Previous</button>
                <button class="control-btn" id="autoRotateBtn" onclick="toggleAutoRotate()">⏸ Pause</button>
                <button class="control-btn" onclick="rotateCarousel(1)">Next →</button>
            </div>
        </div>

        <!-- Bottom Row: 3 Widgets -->
        <div class="bottom-row">
            <!-- Widget 2: Interactive Formula Calculator -->
            <div class="widget">
                <h2>Reparations Formula</h2>
                <p style="color: #9aa5b1; font-size: 0.85em; margin-bottom: 15px;">
                    Example: James Hopewell (32 enslaved people, ~25 years)
                </p>

                <div class="formula-display" id="formulaDisplay">
                    <div class="formula-line" onclick="showFormulaExplanation('wageTheft')">
                        <span class="formula-component">Wage Theft</span> = 32 × $120/day × 25 years × 300 days × inflation(224 years)
                        <br><span style="margin-left: 20px;">= <strong>$2,304,000</strong></span>
                    </div>

                    <div class="formula-line" onclick="showFormulaExplanation('damages')">
                        <span class="formula-component">Human Dignity Damages</span> = 32 × $15,000 × 25 years × 1.5
                        <br><span style="margin-left: 20px;">= <strong>$18,000,000</strong></span>
                    </div>

                    <div class="formula-line" onclick="showFormulaExplanation('profitShare')">
                        <span class="formula-component">Profit Share</span> = 32 × $300/year × 25 years × inflation × 40%
                        <br><span style="margin-left: 20px;">= <strong>$96,000</strong></span>
                    </div>

                    <div class="formula-line" onclick="showFormulaExplanation('interest')">
                        <span class="formula-component">Compound Interest (4%)</span> = Subtotal × (1.04^224 - 1)
                        <br><span style="margin-left: 20px;">= <strong>$40,800,000</strong></span>
                    </div>

                    <div class="formula-line" onclick="showFormulaExplanation('penalty')">
                        <span class="formula-component">Delayed Justice Penalty (2%)</span> = Subtotal × 2% × 224 years
                        <br><span style="margin-left: 20px;">= <strong>$9,216,000</strong></span>
                    </div>

                    <div class="formula-result">
                        <strong>TOTAL REPARATIONS OWED:</strong>
                        <div style="font-size: 1.5em; margin-top: 10px;">$70,416,000</div>
                        <div style="font-size: 0.8em; color: #9aa5b1; margin-top: 5px;">
                            (~$2.2M per enslaved person)
                        </div>
                    </div>
                </div>

                <div class="victim-selector">
                    <label style="color: #9aa5b1; font-size: 0.9em; margin-bottom: 5px; display: block;">
                        Compare with other historical injustices:
                    </label>
                    <select id="victimCategory" onchange="updateFormulaForVictim()">
                        <option value="us_slavery">African Descendant of Slavery (US)</option>
                        <option value="japanese_internment">Japanese Internment Camp Survivor</option>
                        <option value="holocaust">Holocaust Survivor</option>
                        <option value="triangle_shirtwaist">Triangle Shirtwaist Factory Survivor</option>
                        <option value="nl_slavery">African Descendant of Slavery (Netherlands)</option>
                        <option value="ht_slavery">African Descendant of Slavery (Haiti)</option>
                    </select>
                </div>
            </div>

            <!-- Widget 3: Data Browser -->
            <div class="widget">
                <h2>Documented Owners</h2>
                <p style="color: #9aa5b1; font-size: 0.85em; margin-bottom: 15px;">
                    9 slave owners identified across Hopewell-Biscoe lines
                </p>

                <div class="owner-list" id="ownerList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

            <!-- Widget 4: Manual Input Console -->
            <div class="widget">
                <h2>Research Console</h2>
                <div class="console-container">
                    <div class="console-output" id="consoleOutput">
                        <div class="console-line info">╔═══════════════════════════════════════╗</div>
                        <div class="console-line info">║  REPARATIONS RESEARCH CONSOLE v1.0   ║</div>
                        <div class="console-line info">╚═══════════════════════════════════════╝</div>
                        <div class="console-line">Ready to process genealogical records...</div>
                        <div class="console-line">Supported formats: free text, document upload</div>
                        <div class="console-line">─────────────────────────────────────────</div>
                    </div>

                    <div class="console-input-area">
                        <textarea 
                            class="console-input" 
                            id="consoleInput" 
                            placeholder="Enter genealogical data (e.g., 'John Smith owned 12 slaves per his 1845 will in Virginia') or upload a document..."
                        ></textarea>
                        <div class="console-buttons">
                            <button class="console-btn" onclick="processInput()">▶ Process</button>
                            <label class="file-upload-label" for="fileUpload">
                                📄 Upload Document
                            </label>
                            <input type="file" id="fileUpload" accept=".txt,.pdf,.jpg,.png,.csv" onchange="handleFileUpload(event)">
                            <button class="console-btn" onclick="clearConsole()">🗑 Clear</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Formula Explanations -->
    <div class="modal" id="formulaModal">
        <div class="modal-content">
            <h3 id="modalTitle">Formula Component</h3>
            <div id="modalBody"></div>
            <button class="modal-close" onclick="closeModal()">Close</button>
        </div>
    </div>

    <script>
        // Data from CSV
        const ownersData = [
            {
                name: "James Hopewell",
                dates: "Will: 2/14/1816, Probate: 12/23/1817",
                location: "St. Mary's County, MD",
                enslaved: [
                    {name: "Minna", relation: "Mother of 7 children", bequeathedTo: "Henrietta Rebecca Hopewell"},
                    {name: "John", relation: "Child of Minna", bequeathedTo: "Henrietta Rebecca Hopewell"},
                    {name: "Harriett", relation: "Child of Minna", bequeathedTo: "Henrietta Rebecca Hopewell"},
                    {name: "Sandy", relation: "Child of Minna", bequeathedTo: "Henrietta Rebecca Hopewell"},
                    {name: "Henry", relation: "Child of Minna", bequeathedTo: "Henrietta Rebecca Hopewell"},
                    {name: "George", relation: "Child of Minna", bequeathedTo: "Henrietta Rebecca Hopewell"},
                    {name: "Charlotte", relation: "Child of Minna", bequeathedTo: "Henrietta Rebecca Hopewell"},
                    {name: "Jesse", relation: "Child of Minna", bequeathedTo: "Henrietta Rebecca Hopewell"},
                    {name: "Jim", relation: "Husband of Rachel", bequeathedTo: "Olivia Caroline Hopewell"},
                    {name: "Rachel", relation: "Wife of Jim - mother of 5", bequeathedTo: "Olivia Caroline Hopewell"},
                    {name: "Jane", relation: "Child of Jim & Rachel", bequeathedTo: "Olivia Caroline Hopewell"},
                    {name: "Allison", relation: "Child of Jim & Rachel", bequeathedTo: "Olivia Caroline Hopewell"},
                    {name: "Sophy", relation: "Child of Jim & Rachel", bequeathedTo: "Olivia Caroline Hopewell"},
                    {name: "Sally", relation: "Child of Jim & Rachel", bequeathedTo: "Olivia Caroline Hopewell"},
                    {name: "Peggy", relation: "Child of Jim & Rachel", bequeathedTo: "Olivia Caroline Hopewell"},
                    {name: "Medley", relation: "", bequeathedTo: "Ann Maria Biscoe"},
                    {name: "Adam", relation: "", bequeathedTo: "Ann Maria Biscoe"},
                    {name: "Lloyd", relation: "", bequeathedTo: "Ann Maria Biscoe"},
                    {name: "Sarah", relation: "Mother of 3 children", bequeathedTo: "Ann Maria Biscoe"},
                    {name: "Mary", relation: "Child of Sarah", bequeathedTo: "Ann Maria Biscoe"},
                    {name: "Nancy", relation: "Child of Sarah", bequeathedTo: "Ann Maria Biscoe"},
                    {name: "Louisa", relation: "Child of Sarah", bequeathedTo: "Ann Maria Biscoe"},
                    {name: "Esther", relation: "Mother (number unclear)", bequeathedTo: "Ann Maria Biscoe"},
                    {name: "Ally", relation: "Child of Esther", bequeathedTo: "Ann Maria Biscoe"},
                    {name: "Lewis", relation: "Father of Peter & Henny", bequeathedTo: "Angelica Hopewell"},
                    {name: "Peter", relation: "Son of Lewis", bequeathedTo: "Angelica Hopewell"},
                    {name: "Henny", relation: "Daughter of Lewis", bequeathedTo: "Angelica Hopewell"},
                    {name: "Jess", relation: "", bequeathedTo: "Angelica Hopewell"},
                    {name: "Frank", relation: "", bequeathedTo: "Angelica Hopewell"},
                    {name: "Joe", relation: "Husband of Sarah", bequeathedTo: "Angelica Hopewell"},
                    {name: "Sarah", relation: "Wife of Joe", bequeathedTo: "Angelica Hopewell"},
                    {name: "Zekiel", relation: "Described as 'yellow man'", bequeathedTo: "Angelica Hopewell"}
                ],
                count: 32,
                reparations: 70416000,
                descendants: [
                    {generation: "Grandmother", name: "[Your Grandmother's Name]"},
                    {generation: "Mother", name: "[Your Mother's Name]"}
                ]
            },
            {
                name: "Elizabeth Hopewell",
                dates: "Will: 10/16/1787, Probate: 12/10/1787",
                location: "St. Mary's County, MD",
                count: 9,
                reparations: 19750000,
                enslaved: [
                    {name: "Sall", bequeathedTo: "Ann Hebb"},
                    {name: "Delia", relation: "Child", bequeathedTo: "Priscilla Hebb"},
                    {name: "Mary", relation: "Child", bequeathedTo: "Rebecca Hebb"},
                    {name: "Joe Boy", relation: "Man", bequeathedTo: "Elizabeth Emory"},
                    {name: "George", relation: "Boy", bequeathedTo: "Elizabeth Emory"},
                    {name: "Kissey", relation: "Child", bequeathedTo: "Anna Emory"},
                    {name: "Jesse", relation: "Man", bequeathedTo: "Pollard Hopewell"},
                    {name: "Young", relation: "Boy", bequeathedTo: "Pollard Hopewell"},
                    {name: "[Unnamed girl]", relation: "Girl", bequeathedTo: "Elizabeth Hebb"}
                ]
            },
            {
                name: "Ann Hopewell",
                dates: "Will: 5/12/1804, Probate: 2/13/1805",
                location: "Charles County, MD",
                count: 2,
                reparations: 4400000,
                enslaved: [
                    {name: "Phil", bequeathedTo: "Elizabeth Milbourne"},
                    {name: "[Multiple unnamed from Lucretia]", bequeathedTo: "Anna Eliza Dorsey"}
                ]
            },
            {
                name: "Hugh Hopewell",
                dates: "Unknown",
                location: "St. Mary's County, MD",
                count: "Unknown",
                reparations: "Pending Research",
                enslaved: []
            },
            {
                name: "Angelica Hopewell",
                dates: "Survived husband - died after 1817",
                location: "St. Mary's County, MD",
                count: 8,
                reparations: 17600000,
                enslaved: [
                    {name: "Lewis", relation: "Father of Peter & Henny"},
                    {name: "Peter", relation: "Son of Lewis"},
                    {name: "Henny", relation: "Daughter of Lewis"},
                    {name: "Jess"},
                    {name: "Frank"},
                    {name: "Joe", relation: "Husband of Sarah"},
                    {name: "Sarah", relation: "Wife of Joe"},
                    {name: "Zekiel", relation: "Described as 'yellow man'"}
                ]
            },
            {
                name: "Ann Maria (Hopewell) Biscoe",
                dates: "Unknown",
                location: "St. Mary's County MD to Georgetown DC",
                count: 9,
                reparations: 19800000,
                enslaved: [
                    {name: "Medley"},
                    {name: "Adam"},
                    {name: "Lloyd"},
                    {name: "Sarah", relation: "Mother of 3 children"},
                    {name: "Mary", relation: "Child of Sarah"},
                    {name: "Nancy", relation: "Child of Sarah"},
                    {name: "Louisa", relation: "Child of Sarah"},
                    {name: "Esther", relation: "Mother"},
                    {name: "Ally", relation: "Child of Esther"}
                ]
            },
            {
                name: "Araminta Rousby (Carroll) Biscoe",
                dates: "Will dated 1818",
                location: "St. Mary's to Prince George's County, MD",
                count: "Unknown",
                reparations: "Pending Research",
                enslaved: []
            },
            {
                name: "George W. Biscoe",
                dates: "Active 1814-1862+",
                location: "Georgetown DC / Prince George's County, MD",
                count: "Multiple (1850 census)",
                reparations: "Pending Research",
                enslaved: []
            },
            {
                name: "Chew Family",
                dates: "Unknown",
                location: "Calvert County, MD",
                count: "Unknown",
                reparations: "Pending Research",
                enslaved: []
            }
        ];

        // Carousel state
        let currentRotation = 0;
        let autoRotateInterval;
        let isAutoRotating = true;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeCarousel();
            populateOwnerList();
            startAutoRotate();
        });

        function initializeCarousel() {
            const carousel = document.getElementById('carousel');
            const angleStep = 360 / ownersData.length;

            ownersData.forEach((owner, index) => {
                const card = document.createElement('div');
                card.className = 'tree-card';
                card.dataset.index = index;
                
                const angle = angleStep * index;
                const radius = 500;
                const x = Math.sin(angle * Math.PI / 180) * radius;
                const z = Math.cos(angle * Math.PI / 180) * radius;
                
                card.style.transform = `rotateY(${angle}deg) translateZ(${radius}px)`;
                
                let content = `
                    <div class="owner-name">${owner.name}</div>
                    <div class="tree-content">
                        <div style="color: #9aa5b1; font-size: 0.9em; margin-bottom: 10px;">
                            ${owner.dates}<br>
                            ${owner.location}
                        </div>
                `;

                if (owner.enslaved && owner.enslaved.length > 0) {
                    owner.enslaved.slice(0, 8).forEach(person => {
                        content += `
                            <div class="enslaved-person">
                                <span class="person-name">${person.name}</span>
                                ${person.relation ? `<br><span class="person-relation">${person.relation}</span>` : ''}
                                ${person.bequeathedTo ? `<br><span class="person-relation">→ ${person.bequeathedTo}</span>` : ''}
                            </div>
                        `;
                    });
                    if (owner.enslaved.length > 8) {
                        content += `<div style="color: #9aa5b1; text-align: center; margin: 5px 0;">...and ${owner.enslaved.length - 8} more</div>`;
                    }
                }

                if (owner.descendants) {
                    content += `
                        <div class="descendant-section">
                            <div class="descendant-label">↓ Current Descendants ↓</div>
                            ${owner.descendants.map(d => `
                                <div class="enslaved-person" style="border-left-color: #64ff64;">
                                    <span class="person-name" style="color: #64ff64;">${d.generation}</span>
                                    <br><span class="person-relation">${d.name}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                content += `</div>`;
                card.innerHTML = content;
                
                card.addEventListener('click', () => toggleReparationsView(card, owner));
                
                carousel.appendChild(card);
            });
        }

        function rotateCarousel(direction) {
            const angleStep = 360 / ownersData.length;
            currentRotation += angleStep * direction;
            document.getElementById('carousel').style.transform = `rotateY(${-currentRotation}deg)`;
        }

        function startAutoRotate() {
            autoRotateInterval = setInterval(() => {
                if (isAutoRotating) {
                    rotateCarousel(1);
                }
            }, 3000);
        }

        function toggleAutoRotate() {
            isAutoRotating = !isAutoRotating;
            document.getElementById('autoRotateBtn').textContent = isAutoRotating ? '⏸ Pause' : '▶ Play';
        }

        function toggleReparationsView(card, owner) {
            card.classList.toggle('active');
            card.classList.toggle('reparations-view');
            
            if (card.classList.contains('reparations-view') && owner.reparations) {
                const content = card.querySelector('.tree-content');
                const repsPerPerson = Math.round(owner.reparations / owner.count);
                
                let html = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div class="reparations-amount">Total: $${owner.reparations.toLocaleString()}</div>
                        <div style="color: #9aa5b1; font-size: 0.85em;">$${repsPerPerson.toLocaleString()} per person</div>
                    </div>
                `;
                
                // Group by heir
                const byHeir = {};
                owner.enslaved.forEach(person => {
                    const heir = person.bequeathedTo || "Unknown";
                    if (!byHeir[heir]) byHeir[heir] = [];
                    byHeir[heir].push(person);
                });
                
                Object.keys(byHeir).forEach(heir => {
                    const heirCount = byHeir[heir].length;
                    const heirAmount = repsPerPerson * heirCount;
                    html += `
                        <div class="enslaved-person">
                            <span class="person-name">${heir}</span>
                            <br><span class="reparations-amount">$${heirAmount.toLocaleString()}</span>
                            <br><span class="person-relation">${heirCount} person${heirCount > 1 ? 's' : ''}</span>
                        </div>
                    `;
                });
                
                content.innerHTML = html;
            } else {
                // Reset to original view
                initializeCarousel();
            }
        }

        function populateOwnerList() {
            const list = document.getElementById('ownerList');
            ownersData.forEach(owner => {
                const item = document.createElement('div');
                item.className = 'owner-item';
                item.innerHTML = `
                    <div class="owner-item-name">${owner.name}</div>
                    <div class="owner-item-details">
                        ${owner.location}<br>
                        <span class="owner-item-count">${owner.count} enslaved people</span><br>
                        Reparations: ${typeof owner.reparations === 'number' ? '$' + owner.reparations.toLocaleString() : owner.reparations}
                    </div>
                `;
                item.addEventListener('click', () => {
                    addConsoleMessage(`Viewing details for ${owner.name}...`, 'info');
                    // Could expand to show more details
                });
                list.appendChild(item);
            });
        }

        // Formula modal
        const formulaExplanations = {
            wageTheft: {
                title: "Wage Theft Component",
                body: "Enslaved people performed labor worth market wages but received no compensation. This component calculates the value of their unpaid labor:<br><br><strong>Base Daily Wage:</strong> $120 (historical 1800s wage adjusted)<br><strong>Work Days:</strong> 300 days per year (6 days/week)<br><strong>Inflation Multiplier:</strong> Accounts for 224 years of 3.5% annual inflation<br><br>This represents only the direct monetary value of stolen labor, not the additional harm caused."
            },
            damages: {
                title: "Human Dignity Damages",
                body: "Beyond stolen wages, enslaved people suffered profound violations of human rights, family separation, physical abuse, and psychological trauma. This component assigns monetary value to these non-economic harms:<br><br><strong>Base Value:</strong> $15,000 per person per year<br><strong>Multiplier:</strong> 1.5x for compounded, multi-generational harm<br><br>This acknowledges that some harms cannot be fully quantified but must still be compensated."
            },
            profitShare: {
                title: "Profit Share Component",
                body: "Slave labor generated enormous profits for owners through agricultural production, manufacturing, and other economic activity. Enslaved people are entitled to a share of these profits:<br><br><strong>Estimated Annual Profit:</strong> $300 per enslaved person<br><strong>Share Rate:</strong> 40% (representing fair compensation for their labor)<br><strong>Adjustment:</strong> Inflated to current dollars<br><br>This represents the wealth that should have been shared with those who created it."
            },
            interest: {
                title: "Compound Interest",
                body: "Money owed for over 200 years accumulates substantial interest. This component reflects the time value of unpaid debt:<br><br><strong>Interest Rate:</strong> 4% annually (conservative market rate)<br><strong>Period:</strong> 224 years (1800-2024)<br><strong>Formula:</strong> Principal × (1.04^224 - 1)<br><br>This is standard financial practice for any long-term debt."
            },
            penalty: {
                title: "Delayed Justice Penalty",
                body: "Justice delayed is justice denied. This penalty acknowledges the harm caused by the centuries-long delay in addressing this debt:<br><br><strong>Penalty Rate:</strong> 2% per year<br><strong>Period:</strong> 224 years<br><br>This incentivizes timely payment and acknowledges that delayed compensation causes additional harm to victims and their descendants."
            }
        };

        function showFormulaExplanation(component) {
            const modal = document.getElementById('formulaModal');
            const explanation = formulaExplanations[component];
            document.getElementById('modalTitle').textContent = explanation.title;
            document.getElementById('modalBody').innerHTML = explanation.body;
            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('formulaModal').classList.remove('active');
        }

        function updateFormulaForVictim() {
            const category = document.getElementById('victimCategory').value;
            addConsoleMessage(`Formula updated for: ${category}`, 'info');
            // Could implement different calculations for different victim categories
        }

        // Console functions
        function addConsoleMessage(message, type = '') {
            const output = document.getElementById('consoleOutput');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        function processInput() {
            const input = document.getElementById('consoleInput').value.trim();
            if (!input) return;
            
            addConsoleMessage(`Processing: ${input}`, 'info');
            
            // Simple parsing patterns
            const patterns = {
                basic: /(\w+\s+\w+)\s+owned\s+(\d+)\s+slaves?.*(\d{4})/i,
                will: /(\w+\s+\w+).*will.*(\d+)\s+slaves?/i,
                census: /(\d{4})\s+census.*(\w+\s+\w+).*(\d+)/i
            };
            
            let matched = false;
            for (const [pattern, regex] of Object.entries(patterns)) {
                const match = input.match(regex);
                if (match) {
                    matched = true;
                    const name = match[1];
                    const count = match[2];
                    const year = match[3] || "unknown";
                    
                    addConsoleMessage(`✓ Parsed: ${name}, ${count} enslaved people, year ${year}`, 'success');
                    addConsoleMessage(`Calculating reparations...`, 'info');
                    
                    // Simple calculation
                    const reps = count * 2200000; // $2.2M per person average
                    addConsoleMessage(`Estimated reparations: $${reps.toLocaleString()}`, 'success');
                    addConsoleMessage(`Record ready for verification`, 'info');
                    break;
                }
            }
            
            if (!matched) {
                addConsoleMessage(`⚠ Could not parse input. Try format: "Name owned X slaves per YYYY will"`, 'error');
            }
            
            document.getElementById('consoleInput').value = '';
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            addConsoleMessage(`📄 Uploading: ${file.name}`, 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                addConsoleMessage(`File loaded (${content.length} bytes)`, 'success');
                addConsoleMessage(`Analyzing document...`, 'info');
                
                // Simple text analysis
                const slaveCount = (content.match(/slave|negro/gi) || []).length;
                if (slaveCount > 0) {
                    addConsoleMessage(`Found ${slaveCount} references to enslaved people`, 'info');
                    addConsoleMessage(`Document analysis complete - manual review required`, 'success');
                } else {
                    addConsoleMessage(`No obvious slavery references found`, 'error');
                }
            };
            
            reader.readAsText(file);
        }

        function clearConsole() {
            document.getElementById('consoleOutput').innerHTML = `
                <div class="console-line info">╔═══════════════════════════════════════╗</div>
                <div class="console-line info">║  REPARATIONS RESEARCH CONSOLE v1.0   ║</div>
                <div class="console-line info">╚═══════════════════════════════════════╝</div>
                <div class="console-line">Console cleared. Ready for new input...</div>
                <div class="console-line">─────────────────────────────────────────</div>
            `;
        }

        // Wallet functions
        document.getElementById('connectWallet').addEventListener('click', async function() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    document.getElementById('walletStatus').textContent = `Connected: ${accounts[0].substring(0, 6)}...${accounts[0].substring(38)}`;
                    document.getElementById('walletStatus').classList.add('connected');
                    addConsoleMessage(`Wallet connected: ${accounts[0]}`, 'success');
                } catch (error) {
                    addConsoleMessage(`Wallet connection failed: ${error.message}`, 'error');
                }
            } else {
                addConsoleMessage('MetaMask not detected. Please install MetaMask.', 'error');
                alert('Please install MetaMask to use blockchain features');
            }
        });

        function exportData() {
            addConsoleMessage('Generating export report...', 'info');
            const data = JSON.stringify(ownersData, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'reparations-data-export.json';
            a.click();
            addConsoleMessage('Report exported successfully', 'success');
        }

        function showSettings() {
            addConsoleMessage('Opening settings...', 'info');
            alert('Settings panel - Coming soon');
        }

        function showHelp() {
            addConsoleMessage('Opening help documentation...', 'info');
            alert('Help & Documentation - Coming soon');
        }

        // Close modal on outside click
        document.getElementById('formulaModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Enter key in console
        document.getElementById('consoleInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                processInput();
            }
        });
    </script>
</body>
</html>
